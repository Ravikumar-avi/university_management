<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View - Hostel Complaint -->
    <record id="hostel_complaint_view_form" model="ir.ui.view">
        <field name="name">hostel.complaint.view.form</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <form string="Hostel Complaint">
                <header>
                    <button name="action_assign" type="object" string="Assign &amp; Start Progress"
                            class="oe_highlight"
                            invisible="state != 'new'"
                            confirm="Are you sure you want to assign and start working on this complaint?"/>
                    <button name="action_resolve" type="object" string="Mark as Resolved"
                            invisible="state not in ['new', 'in_progress']"
                            confirm="Are you sure you want to mark this complaint as resolved?"/>
                    <button name="action_close" type="object" string="Close Complaint"
                            invisible="state != 'resolved'"
                            confirm="Are you sure you want to close this complaint?"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="new,in_progress,resolved,closed"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="New" bg_color="text-bg-primary"
                            invisible="state != 'new'"/>
                    <widget name="web_ribbon" title="In Progress" bg_color="text-bg-warning"
                            invisible="state != 'in_progress'"/>
                    <widget name="web_ribbon" title="Resolved" bg_color="text-bg-success"
                            invisible="state != 'resolved'"/>
                    <widget name="web_ribbon" title="Closed" bg_color="text-bg-secondary"
                            invisible="state != 'closed'"/>

                    <div class="oe_title">
                        <label for="name" string="Complaint Number"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Complaint Information">
                            <field name="student_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="complaint_type"/>
                            <field name="complaint_date" widget="date"/>
                            <field name="priority" widget="priority"/>
                        </group>
                        <group string="Location">
                            <field name="hostel_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="room_id"
                                   domain="[('hostel_id', '=', hostel_id)]"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="assigned_to"/>
                        </group>
                    </group>

                    <group>
                        <field name="subject" placeholder="Enter complaint subject..."/>
                    </group>

                    <notebook>
                        <page string="Complaint Details" name="complaint_details">
                            <group>
                                <field name="description" nolabel="1"
                                       placeholder="Describe the complaint in detail..."/>
                            </group>
                        </page>

                        <page string="Resolution" name="resolution"
                              invisible="state not in ['resolved', 'closed']">
                            <group>
                                <group>
                                    <field name="resolution_date" widget="date" readonly="1"/>
                                </group>
                            </group>
                            <group>
                                <field name="resolution_details" nolabel="1"
                                       placeholder="Enter resolution details..."/>
                            </group>
                        </page>

                        <page string="Attachments" name="attachments">
                            <field name="attachment_ids" widget="many2many_binary"
                                   nolabel="1"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- List View - Hostel Complaint -->
    <record id="hostel_complaint_view_list" model="ir.ui.view">
        <field name="name">hostel.complaint.view.list</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <list string="Hostel Complaints"
                  default_order="complaint_date desc"
                  multi_edit="1"
                  sample="1"
                  decoration-primary="state == 'new'"
                  decoration-warning="state == 'in_progress'"
                  decoration-success="state == 'resolved'"
                  decoration-muted="state == 'closed'">
                <field name="name"/>
                <field name="complaint_date"/>
                <field name="student_id"/>
                <field name="hostel_id"/>
                <field name="room_id" optional="show"/>
                <field name="complaint_type"/>
                <field name="subject"/>
                <field name="priority" widget="priority" optional="show"/>
                <field name="assigned_to" optional="show" widget="many2one_avatar_user"/>
                <field name="resolution_date" optional="hide"/>
                <field name="state" widget="badge"
                       decoration-primary="state == 'new'"
                       decoration-warning="state == 'in_progress'"
                       decoration-success="state == 'resolved'"
                       decoration-muted="state == 'closed'"/>
            </list>
        </field>
    </record>

    <!-- Search View - Hostel Complaint -->
    <record id="hostel_complaint_view_search" model="ir.ui.view">
        <field name="name">hostel.complaint.view.search</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <search string="Search Complaints">
                <field name="name"/>
                <field name="student_id"/>
                <field name="hostel_id"/>
                <field name="room_id"/>
                <field name="subject"/>
                <field name="complaint_type"/>
                <field name="assigned_to"/>

                <separator/>

                <filter name="filter_new" string="New"
                        domain="[('state', '=', 'new')]"/>
                <filter name="filter_in_progress" string="In Progress"
                        domain="[('state', '=', 'in_progress')]"/>
                <filter name="filter_resolved" string="Resolved"
                        domain="[('state', '=', 'resolved')]"/>
                <filter name="filter_closed" string="Closed"
                        domain="[('state', '=', 'closed')]"/>

                <separator/>

                <filter name="filter_urgent" string="Urgent Priority"
                        domain="[('priority', '=', 'urgent')]"/>
                <filter name="filter_high" string="High Priority"
                        domain="[('priority', '=', 'high')]"/>
                <filter name="filter_medium" string="Medium Priority"
                        domain="[('priority', '=', 'medium')]"/>
                <filter name="filter_low" string="Low Priority"
                        domain="[('priority', '=', 'low')]"/>

                <separator/>

                <filter name="filter_maintenance" string="Maintenance"
                        domain="[('complaint_type', '=', 'maintenance')]"/>
                <filter name="filter_cleanliness" string="Cleanliness"
                        domain="[('complaint_type', '=', 'cleanliness')]"/>
                <filter name="filter_electricity" string="Electricity"
                        domain="[('complaint_type', '=', 'electricity')]"/>
                <filter name="filter_plumbing" string="Plumbing"
                        domain="[('complaint_type', '=', 'plumbing')]"/>
                <filter name="filter_wifi" string="WiFi"
                        domain="[('complaint_type', '=', 'wifi')]"/>
                <filter name="filter_food" string="Food Quality"
                        domain="[('complaint_type', '=', 'food')]"/>
                <filter name="filter_security" string="Security"
                        domain="[('complaint_type', '=', 'security')]"/>

                <separator/>

                <filter name="filter_today" string="Today"
                        domain="[('complaint_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_week" string="This Week"
                        domain="[('complaint_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')),
                                 ('complaint_date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_month" string="This Month"
                        domain="[('complaint_date', '&gt;=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                                 ('complaint_date', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>

                <separator/>

                <filter name="filter_my_complaints" string="My Complaints"
                        domain="[('student_id.user_id', '=', uid)]"/>
                <filter name="filter_assigned_to_me" string="Assigned to Me"
                        domain="[('assigned_to', '=', uid)]"/>
                <filter name="filter_unassigned" string="Unassigned"
                        domain="[('assigned_to', '=', False)]"/>
                <filter name="filter_pending" string="Pending (New + In Progress)"
                        domain="[('state', 'in', ['new', 'in_progress'])]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_student" string="Student"
                            context="{'group_by': 'student_id'}"/>
                    <filter name="group_by_hostel" string="Hostel"
                            context="{'group_by': 'hostel_id'}"/>
                    <filter name="group_by_room" string="Room"
                            context="{'group_by': 'room_id'}"/>
                    <filter name="group_by_complaint_type" string="Complaint Type"
                            context="{'group_by': 'complaint_type'}"/>
                    <filter name="group_by_priority" string="Priority"
                            context="{'group_by': 'priority'}"/>
                    <filter name="group_by_assigned_to" string="Assigned To"
                            context="{'group_by': 'assigned_to'}"/>
                    <filter name="group_by_state" string="Status"
                            context="{'group_by': 'state'}"/>
                    <filter name="group_by_complaint_date" string="Complaint Date"
                            context="{'group_by': 'complaint_date'}"/>
                </group>

                <searchpanel>
                    <field name="hostel_id" string="Hostel"
                           select="multi"
                           icon="fa-building"/>
                    <field name="complaint_type" string="Type"
                           select="multi"
                           icon="fa-tag"/>
                    <field name="priority" string="Priority"
                           select="multi"
                           icon="fa-exclamation-triangle"/>
                    <field name="state" string="Status"
                           select="multi"
                           icon="fa-filter"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View - Hostel Complaint -->
    <record id="hostel_complaint_view_kanban" model="ir.ui.view">
        <field name="name">hostel.complaint.view.kanban</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="state"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="student_id"/>
                <field name="hostel_id"/>
                <field name="room_id"/>
                <field name="complaint_type"/>
                <field name="complaint_date"/>
                <field name="subject"/>
                <field name="priority"/>
                <field name="assigned_to"/>
                <field name="resolution_date"/>
                <field name="state"/>

                <progressbar field="state"
                             colors='{"new": "primary", "in_progress": "warning", "resolved": "success", "closed": "muted"}'/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'new'">
                                <span class="text-bg-primary">New</span>
                            </div>
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'in_progress'">
                                <span class="text-bg-warning">In Progress</span>
                            </div>
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'resolved'">
                                <span class="text-bg-success">Resolved</span>
                            </div>
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'closed'">
                                <span class="text-bg-secondary">Closed</span>
                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="text-muted">
                                            <field name="subject"/>
                                        </div>
                                    </div>
                                    <span class="float-end">
                                        <field name="priority" widget="priority"/>
                                    </span>
                                </div>

                                <div class="o_kanban_record_body mt-3">
                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <div class="mb-1">
                                                    <i class="fa fa-user text-primary"/>
                                                    <strong>Reported By:</strong> <field name="student_id"/>
                                                </div>
                                                <div class="mb-1">
                                                    <i class="fa fa-building text-info"/>
                                                    <strong>Hostel:</strong> <field name="hostel_id"/>
                                                </div>
                                                <div class="mb-1" t-if="record.room_id.raw_value">
                                                    <i class="fa fa-home text-success"/>
                                                    <strong>Room:</strong> <field name="room_id"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <div class="card bg-primary text-white">
                                                <div class="card-body p-2 text-center">
                                                    <h6 class="mb-0"><field name="complaint_type"/></h6>
                                                    <small>Type</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="card bg-info text-white">
                                                <div class="card-body p-2 text-center">
                                                    <h6 class="mb-0"><field name="complaint_date"/></h6>
                                                    <small>Date</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2" t-if="record.assigned_to.raw_value">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <div class="mb-1">
                                                    <i class="fa fa-user-circle text-warning"/>
                                                    <strong>Assigned To:</strong> <field name="assigned_to" widget="many2one_avatar_user"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2" t-if="record.resolution_date.raw_value">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <div class="mb-1">
                                                    <i class="fa fa-check-circle text-success"/>
                                                    <strong>Resolved On:</strong> <field name="resolution_date"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom mt-2">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="state" widget="badge"
                                               decoration-primary="state == 'new'"
                                               decoration-warning="state == 'in_progress'"
                                               decoration-success="state == 'resolved'"
                                               decoration-muted="state == 'closed'"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendar View - Hostel Complaint -->
    <record id="hostel_complaint_view_calendar" model="ir.ui.view">
        <field name="name">hostel.complaint.view.calendar</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <calendar string="Complaint Calendar"
                      date_start="complaint_date"
                      color="priority"
                      mode="month"
                      quick_create="0"
                      event_open_popup="1">
                <field name="student_id"/>
                <field name="hostel_id"/>
                <field name="complaint_type"/>
                <field name="priority"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Pivot View - Hostel Complaint -->
    <record id="hostel_complaint_view_pivot" model="ir.ui.view">
        <field name="name">hostel.complaint.view.pivot</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <pivot string="Complaint Analysis">
                <field name="complaint_date" type="row" interval="day"/>
                <field name="hostel_id" type="row"/>
                <field name="complaint_type" type="col"/>
                <field name="state" type="col"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View - Hostel Complaint -->
    <record id="hostel_complaint_view_graph" model="ir.ui.view">
        <field name="name">hostel.complaint.view.graph</field>
        <field name="model">hostel.complaint</field>
        <field name="arch" type="xml">
            <graph string="Complaint Statistics" type="bar">
                <field name="complaint_date" interval="day"/>
                <field name="complaint_type" type="col"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_hostel_complaint" model="ir.actions.act_window">
        <field name="name">Complaints</field>
        <field name="res_model">hostel.complaint</field>
        <field name="view_mode">list,kanban,calendar,form,pivot,graph</field>
        <field name="context">{'search_default_filter_pending': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register Hostel Complaint
            </p>
            <p>
                Manage hostel complaints and issues. System automatically assigns unique complaint
                numbers using sequence. Select student ("Reported By", student.student, required,
                tracked). Select hostel (hostel.hostel, required). Select room (hostel.room, optional,
                domain filters by hostel_id). Select complaint_type (9 options, required, tracked):
                Maintenance Issue (broken furniture/fixtures), Cleanliness Issue (dirty rooms/bathrooms),
                Electrical Problem (power/lights/fan), Plumbing Issue (water/drainage/leaks), WiFi Issue
                (internet connectivity), Food Quality (mess complaints), Security Concern (safety issues),
                Noise Complaint (disturbance), Other (miscellaneous). Enter complaint_date (default today,
                required), subject (char, required, brief title), description (Html, required, detailed
                explanation). Select priority (4 options, default 'medium', tracked, priority widget):
                Low, Medium, High, Urgent. Assign to staff member (assigned_to, res.users, tracked).
                4-state workflow with 3 action buttons: New (default) → Assign &amp; Start Progress button
                (highlight, new only, confirmation, sets state='in_progress') → Mark as Resolved button
                (new/in_progress, confirmation, sets state='resolved' + resolution_date=today, shows
                resolution page) → Close Complaint button (resolved only, confirmation, sets
                state='closed'). Resolution page (visible only when resolved/closed): resolution_date
                (readonly auto-filled), resolution_details (Html). Attachments page with Many2many binary
                widget for photos/documents. Calendar view shows complaints by date (color by priority).
                Pivot/graph views for complaint analysis. Full chatter support for communication and
                tracking.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_hostel_complaint"-->
<!--              name="Complaints"-->
<!--              parent="menu_hostel_root"-->
<!--              action="action_hostel_complaint"-->
<!--              sequence="50"/>-->

</odoo>
