<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View -->
    <record id="exam_timetable_view_form" model="ir.ui.view">
        <field name="name">examination.timetable.view.form</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <form string="Exam Timetable">
                <header>
                    <button name="action_start" type="object" string="Start Exam"
                            class="oe_highlight"
                            invisible="state != 'scheduled'"/>
                    <button name="action_complete" type="object" string="Mark as Completed"
                            class="oe_highlight"
                            invisible="state != 'ongoing'"/>
                    <button name="action_cancel" type="object" string="Cancel Exam"
                            invisible="state in ['completed', 'cancelled']"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="scheduled,ongoing,completed"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Ongoing" bg_color="text-bg-info"
                            invisible="state != 'ongoing'"/>
                    <widget name="web_ribbon" title="Completed" bg_color="text-bg-success"
                            invisible="state != 'completed'"/>
                    <widget name="web_ribbon" title="Cancelled" bg_color="text-bg-danger"
                            invisible="state != 'cancelled'"/>

                    <div class="oe_title">
                        <label for="name" string="Reference"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Examination Details">
                            <field name="examination_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="course_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="subject_id" readonly="1"/>
                            <field name="program_id" readonly="1"/>
                            <field name="department_id" readonly="1"/>
                            <field name="semester_id" readonly="1"/>
                        </group>
                        <group string="Schedule">
                            <field name="exam_date" widget="date"/>
                            <label for="start_time"/>
                            <div class="o_row">
                                <field name="start_time" widget="float_time" class="oe_inline"/>
                                <span class="text-muted">(24-hour format)</span>
                            </div>
                            <label for="end_time"/>
                            <div class="o_row">
                                <field name="end_time" widget="float_time" class="oe_inline"/>
                                <span class="text-muted">(24-hour format)</span>
                            </div>
                            <field name="duration" readonly="1" widget="float_time"/>
                        </group>
                    </group>

                    <group>
                        <group string="Marks Configuration">
                            <field name="max_marks"/>
                            <field name="passing_marks"/>
                        </group>
                        <group string="Venue Details">
                            <field name="venue" placeholder="e.g., Main Hall, Auditorium"/>
                            <field name="room_numbers" placeholder="e.g., R101, R102, R103"/>
                        </group>
                    </group>

                    <group>
                        <group string="Invigilators">
                            <field name="invigilator_ids" widget="many2many_tags"
                                   options="{'color_field': 'color', 'no_create': True}"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Instructions" name="instructions">
                            <field name="instructions"
                                   placeholder="Enter specific instructions for this exam..."/>
                        </page>

                        <page string="Notes" name="notes">
                            <field name="notes"
                                   placeholder="Enter any additional notes..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- List View -->
    <record id="exam_timetable_view_list" model="ir.ui.view">
        <field name="name">examination.timetable.view.list</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <list string="Exam Timetable"
                  default_order="exam_date, start_time"
                  multi_edit="1"
                  sample="1"
                  decoration-success="state == 'completed'"
                  decoration-info="state == 'ongoing'"
                  decoration-muted="state == 'cancelled'"
                  decoration-primary="state == 'scheduled'">
                <field name="name"/>
                <field name="examination_id"/>
                <field name="subject_id"/>
                <field name="program_id" optional="hide"/>
                <field name="department_id" optional="show"/>
                <field name="semester_id" optional="show"/>
                <field name="exam_date"/>
                <field name="start_time" widget="float_time"/>
                <field name="end_time" widget="float_time"/>
                <field name="duration" widget="float_time" optional="show"/>
                <field name="venue" optional="show"/>
                <field name="room_numbers" optional="hide"/>
                <field name="max_marks" optional="hide"/>
                <field name="passing_marks" optional="hide"/>
                <field name="invigilator_ids" widget="many2many_tags" optional="hide"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'completed'"
                       decoration-info="state == 'ongoing'"
                       decoration-danger="state == 'cancelled'"
                       decoration-primary="state == 'scheduled'"/>
            </list>
        </field>
    </record>

    <!-- Search View -->
    <record id="exam_timetable_view_search" model="ir.ui.view">
        <field name="name">examination.timetable.view.search</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <search string="Search Exam Timetable">
                <field name="name"/>
                <field name="examination_id"/>
                <field name="subject_id"/>
                <field name="course_id"/>
                <field name="department_id"/>
                <field name="venue"/>

                <separator/>

                <filter name="filter_scheduled" string="Scheduled"
                        domain="[('state', '=', 'scheduled')]"/>
                <filter name="filter_ongoing" string="Ongoing"
                        domain="[('state', '=', 'ongoing')]"/>
                <filter name="filter_completed" string="Completed"
                        domain="[('state', '=', 'completed')]"/>
                <filter name="filter_cancelled" string="Cancelled"
                        domain="[('state', '=', 'cancelled')]"/>

                <separator/>

                <filter name="filter_today" string="Today"
                        domain="[('exam_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_week" string="This Week"
                        domain="[('exam_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')),
                                 ('exam_date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_month" string="This Month"
                        domain="[('exam_date', '&gt;=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                                 ('exam_date', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_upcoming" string="Upcoming Exams"
                        domain="[('exam_date', '&gt;=', context_today().strftime('%Y-%m-%d')), ('state', '=', 'scheduled')]"/>

                <separator/>

                <filter name="filter_morning" string="Morning Session (Before 12 PM)"
                        domain="[('start_time', '&lt;', 12)]"/>
                <filter name="filter_afternoon" string="Afternoon Session (After 12 PM)"
                        domain="[('start_time', '&gt;=', 12)]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_examination" string="Examination"
                            context="{'group_by': 'examination_id'}"/>
                    <filter name="group_by_subject" string="Subject"
                            context="{'group_by': 'subject_id'}"/>
                    <filter name="group_by_program" string="Program"
                            context="{'group_by': 'program_id'}"/>
                    <filter name="group_by_department" string="Department"
                            context="{'group_by': 'department_id'}"/>
                    <filter name="group_by_semester" string="Semester"
                            context="{'group_by': 'semester_id'}"/>
                    <filter name="group_by_exam_date" string="Exam Date"
                            context="{'group_by': 'exam_date'}"/>
                    <filter name="group_by_venue" string="Venue"
                            context="{'group_by': 'venue'}"/>
                    <filter name="group_by_state" string="Status"
                            context="{'group_by': 'state'}"/>
                </group>

                <searchpanel>
                    <field name="examination_id" string="Examination"
                           select="multi"
                           icon="fa-graduation-cap"/>
                    <field name="department_id" string="Department"
                           select="multi"
                           icon="fa-building"/>
                    <field name="semester_id" string="Semester"
                           select="multi"
                           icon="fa-list-ol"/>
                    <field name="state" string="Status"
                           select="multi"
                           icon="fa-filter"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="exam_timetable_view_kanban" model="ir.ui.view">
        <field name="name">examination.timetable.view.kanban</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="state"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="examination_id"/>
                <field name="subject_id"/>
                <field name="program_id"/>
                <field name="department_id"/>
                <field name="semester_id"/>
                <field name="exam_date"/>
                <field name="start_time"/>
                <field name="end_time"/>
                <field name="duration"/>
                <field name="venue"/>
                <field name="room_numbers"/>
                <field name="max_marks"/>
                <field name="passing_marks"/>
                <field name="invigilator_ids"/>
                <field name="state"/>

                <progressbar field="state"
                             colors='{"scheduled": "primary", "ongoing": "info", "completed": "success", "cancelled": "danger"}'/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'ongoing'">
                                <span class="text-bg-info">Ongoing</span>
                            </div>
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'completed'">
                                <span class="text-bg-success">Completed</span>
                            </div>
                            <div class="ribbon ribbon-top-right" t-if="record.state.raw_value == 'cancelled'">
                                <span class="text-bg-danger">Cancelled</span>
                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="subject_id"/>
                                        </strong>
                                        <div class="text-muted">
                                            <field name="examination_id"/>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <field name="state" widget="badge"
                                               decoration-success="state == 'completed'"
                                               decoration-info="state == 'ongoing'"
                                               decoration-danger="state == 'cancelled'"
                                               decoration-primary="state == 'scheduled'"/>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body">
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <i class="fa fa-building text-primary"/>
                                            <field name="department_id"/>
                                        </div>
                                        <div class="col-6">
                                            <i class="fa fa-list-ol text-info"/>
                                            <field name="semester_id"/>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-calendar text-danger"/>
                                                        <strong> Date:</strong>
                                                    </span>
                                                    <strong class="text-danger">
                                                        <field name="exam_date"/>
                                                    </strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-clock-o text-success"/>
                                                        <strong> Start:</strong>
                                                    </span>
                                                    <strong>
                                                        <field name="start_time" widget="float_time"/>
                                                    </strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-clock-o text-warning"/>
                                                        <strong> End:</strong>
                                                    </span>
                                                    <strong>
                                                        <field name="end_time" widget="float_time"/>
                                                    </strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-hourglass-half text-info"/>
                                                        <strong> Duration:</strong>
                                                    </span>
                                                    <strong class="text-primary">
                                                        <field name="duration" widget="float_time"/>
                                                    </strong>
                                                </div>
                                                <hr class="my-1"/>
                                                <div class="d-flex justify-content-between mb-1" t-if="record.venue.raw_value">
                                                    <span>
                                                        <i class="fa fa-map-marker text-secondary"/>
                                                        <strong> Venue:</strong>
                                                    </span>
                                                    <strong><field name="venue"/></strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span><strong>Max Marks:</strong></span>
                                                    <strong class="text-success">
                                                        <field name="max_marks"/>
                                                    </strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mt-2" t-if="record.invigilator_ids.raw_value.length">
                                        <div class="col-12">
                                            <small class="text-muted">
                                                <i class="fa fa-user-shield"/> Invigilators
                                            </small>
                                            <div>
                                                <field name="invigilator_ids" widget="many2many_tags"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_right">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendar View -->
    <record id="exam_timetable_view_calendar" model="ir.ui.view">
        <field name="name">examination.timetable.view.calendar</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <calendar string="Exam Timetable Calendar"
                      date_start="exam_date"
                      mode="month"
                      color="state"
                      quick_create="false"
                      event_open_popup="true">
                <field name="subject_id"/>
                <field name="start_time" widget="float_time"/>
                <field name="end_time" widget="float_time"/>
                <field name="venue"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="exam_timetable_view_pivot" model="ir.ui.view">
        <field name="name">examination.timetable.view.pivot</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <pivot string="Timetable Analysis">
                <field name="exam_date" type="row" interval="day"/>
                <field name="department_id" type="col"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="exam_timetable_view_graph" model="ir.ui.view">
        <field name="name">examination.timetable.view.graph</field>
        <field name="model">examination.timetable</field>
        <field name="arch" type="xml">
            <graph string="Timetable Statistics" type="bar">
                <field name="exam_date" interval="day"/>
                <field name="state"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_exam_timetable" model="ir.actions.act_window">
        <field name="name">Exam Timetable</field>
        <field name="res_model">examination.timetable</field>
        <field name="view_mode">calendar,list,kanban,form,pivot,graph</field>
        <field name="context">{'search_default_filter_upcoming': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Exam Timetable
            </p>
            <p>
                Schedule exams with date, time (24-hour format), and duration. Specify venue,
                room numbers, and maximum/passing marks. Assign invigilators for supervision.
                Add specific instructions in HTML format. Track exam status from scheduled
                through ongoing to completed. Automatic duration calculation based on start
                and end times. Validates time ranges and ensures exam dates fall within
                examination period.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_exam_timetable"-->
<!--              name="Exam Timetable"-->
<!--              parent="menu_examination_root"-->
<!--              action="action_exam_timetable"-->
<!--              sequence="20"/>-->

</odoo>
