<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View -->
    <record id="exam_seating_view_form" model="ir.ui.view">
        <field name="name">examination.seating.view.form</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <form string="Exam Seating">
                <header>
                    <button name="action_confirm" type="object" string="Confirm Seating"
                            class="oe_highlight"
                            invisible="is_confirmed"/>
                    <field name="state" widget="statusbar"
                            statusbar_visible="draft,confirmed,cancelled"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Confirmed" bg_color="text-bg-success"
                            invisible="not is_confirmed"/>

                    <div class="oe_title">
                        <label for="name" string="Reference"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Examination Details">
                            <field name="examination_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="timetable_id"
                                   domain="[('examination_id', '=', examination_id)]"
                                   options="{'no_create': True}"/>
                            <field name="exam_date" readonly="1"/>
                            <field name="subject_id" readonly="1"/>
                        </group>
                        <group string="Student Details">
                            <field name="student_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="registration_number" readonly="1"/>
                            <field name="hall_ticket_id"
                                   options="{'no_create': True}"/>
                        </group>
                    </group>

                    <group>
                        <group string="Room Details">
                            <field name="room_number"/>
                            <field name="building"/>
                            <field name="floor"/>
                            <field name="venue"/>
                        </group>
                        <group string="Seat Details">
                            <field name="seat_number"/>
                            <field name="row_number"/>
                            <field name="column_number"/>
                        </group>
                    </group>

                    <group>
                        <group string="Invigilators">
                            <field name="invigilator_ids" widget="many2many_tags"
                                   options="{'color_field': 'color', 'no_create': True}"/>
                        </group>
                    </group>

                    <separator string="Remarks"/>
                    <field name="remarks"
                           placeholder="Enter any remarks about seating arrangement..."/>
                </sheet>
            </form>
        </field>
    </record>

    <!-- List View -->
    <record id="exam_seating_view_list" model="ir.ui.view">
        <field name="name">examination.seating.view.list</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <list string="Exam Seating"
                  default_order="examination_id, room_number, seat_number"
                  multi_edit="1"
                  sample="1"
                  decoration-success="is_confirmed == True"
                  decoration-muted="is_confirmed == False">
                <field name="name"/>
                <field name="examination_id"/>
                <field name="exam_date" optional="show"/>
                <field name="subject_id" optional="show"/>
                <field name="timetable_id" optional="hide"/>
                <field name="student_id"/>
                <field name="registration_number" optional="show"/>
                <field name="hall_ticket_id" optional="hide"/>
                <field name="room_number"/>
                <field name="building" optional="show"/>
                <field name="floor" optional="hide"/>
                <field name="seat_number"/>
                <field name="row_number" optional="show"/>
                <field name="column_number" optional="show"/>
                <field name="venue" optional="show"/>
                <field name="invigilator_ids" widget="many2many_tags" optional="hide"/>
                <field name="is_confirmed" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- Search View -->
    <record id="exam_seating_view_search" model="ir.ui.view">
        <field name="name">examination.seating.view.search</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <search string="Search Exam Seating">
                <field name="name"/>
                <field name="examination_id"/>
                <field name="student_id"/>
                <field name="registration_number"/>
                <field name="room_number"/>
                <field name="seat_number"/>
                <field name="building"/>
                <field name="venue"/>

                <separator/>

                <filter name="filter_confirmed" string="Confirmed"
                        domain="[('is_confirmed', '=', True)]"/>
                <filter name="filter_not_confirmed" string="Not Confirmed"
                        domain="[('is_confirmed', '=', False)]"/>

                <separator/>

                <filter name="filter_today" string="Today's Exams"
                        domain="[('exam_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_upcoming" string="Upcoming Exams"
                        domain="[('exam_date', '&gt;=', context_today().strftime('%Y-%m-%d'))]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_examination" string="Examination"
                            context="{'group_by': 'examination_id'}"/>
                    <filter name="group_by_subject" string="Subject"
                            context="{'group_by': 'subject_id'}"/>
                    <filter name="group_by_room" string="Room Number"
                            context="{'group_by': 'room_number'}"/>
                    <filter name="group_by_building" string="Building"
                            context="{'group_by': 'building'}"/>
                    <filter name="group_by_venue" string="Venue"
                            context="{'group_by': 'venue'}"/>
                    <filter name="group_by_exam_date" string="Exam Date"
                            context="{'group_by': 'exam_date'}"/>
                    <filter name="group_by_confirmed" string="Confirmation Status"
                            context="{'group_by': 'is_confirmed'}"/>
                </group>

                <searchpanel>
                    <field name="examination_id" string="Examination"
                           select="multi"
                           icon="fa-graduation-cap"/>
                    <field name="subject_id" string="Subject"
                           select="multi"
                           icon="fa-book"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="exam_seating_view_kanban" model="ir.ui.view">
        <field name="name">examination.seating.view.kanban</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="room_number"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="examination_id"/>
                <field name="exam_date"/>
                <field name="subject_id"/>
                <field name="student_id"/>
                <field name="registration_number"/>
                <field name="hall_ticket_id"/>
                <field name="room_number"/>
                <field name="building"/>
                <field name="floor"/>
                <field name="seat_number"/>
                <field name="row_number"/>
                <field name="column_number"/>
                <field name="venue"/>
                <field name="invigilator_ids"/>
                <field name="is_confirmed"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="ribbon ribbon-top-right" t-if="record.is_confirmed.raw_value">
                                <span class="text-bg-success">Confirmed</span>
                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="student_id"/>
                                        </strong>
                                        <div class="text-muted">
                                            <field name="registration_number"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body">
                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <i class="fa fa-graduation-cap text-primary"/>
                                            <strong><field name="examination_id"/></strong>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <i class="fa fa-book text-info"/>
                                            <field name="subject_id"/>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <i class="fa fa-calendar text-secondary"/>
                                            Exam Date: <field name="exam_date"/>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-door-open text-warning"/>
                                                        <strong> Room:</strong>
                                                    </span>
                                                    <strong class="text-primary">
                                                        <field name="room_number"/>
                                                    </strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-building text-success"/>
                                                        <strong> Building:</strong>
                                                    </span>
                                                    <strong><field name="building"/></strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1">
                                                    <span>
                                                        <i class="fa fa-chair text-danger"/>
                                                        <strong> Seat:</strong>
                                                    </span>
                                                    <strong class="text-danger">
                                                        <field name="seat_number"/>
                                                    </strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1" t-if="record.row_number.raw_value">
                                                    <span><strong>Row:</strong></span>
                                                    <strong><field name="row_number"/></strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-1" t-if="record.column_number.raw_value">
                                                    <span><strong>Column:</strong></span>
                                                    <strong><field name="column_number"/></strong>
                                                </div>
                                                <div class="d-flex justify-content-between" t-if="record.venue.raw_value">
                                                    <span>
                                                        <i class="fa fa-map-marker text-info"/>
                                                        <strong> Venue:</strong>
                                                    </span>
                                                    <strong><field name="venue"/></strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mt-2" t-if="record.invigilator_ids.raw_value.length">
                                        <div class="col-12">
                                            <small class="text-muted">
                                                <i class="fa fa-user-shield"/> Invigilators
                                            </small>
                                            <div>
                                                <field name="invigilator_ids" widget="many2many_tags"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendar View -->
    <record id="exam_seating_view_calendar" model="ir.ui.view">
        <field name="name">examination.seating.view.calendar</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <calendar string="Exam Seating Calendar"
                      date_start="exam_date"
                      mode="month"
                      color="room_number"
                      quick_create="false">
                <field name="student_id"/>
                <field name="room_number"/>
                <field name="seat_number"/>
                <field name="subject_id"/>
            </calendar>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="exam_seating_view_pivot" model="ir.ui.view">
        <field name="name">examination.seating.view.pivot</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <pivot string="Seating Analysis">
                <field name="room_number" type="row"/>
                <field name="examination_id" type="col"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="exam_seating_view_graph" model="ir.ui.view">
        <field name="name">examination.seating.view.graph</field>
        <field name="model">examination.seating</field>
        <field name="arch" type="xml">
            <graph string="Seating Statistics" type="bar">
                <field name="room_number"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_exam_seating" model="ir.actions.act_window">
        <field name="name">Exam Seating</field>
        <field name="res_model">examination.seating</field>
        <field name="view_mode">list,kanban,form,calendar,pivot,graph</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Exam Seating Arrangement
            </p>
            <p>
                Manage exam seating arrangements with room and seat allocation. Assign students
                to specific rooms, seats, rows, and columns. Track building, floor, and venue details.
                Assign invigilators for exam supervision. Use auto-generation feature to quickly
                allocate seats (30 students per room by default). Confirm seating arrangements
                once finalized.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_exam_seating"-->
<!--              name="Seating Arrangement"-->
<!--              parent="menu_examination_root"-->
<!--              action="action_exam_seating"-->
<!--              sequence="60"/>-->

</odoo>
