<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View -->
    <record id="faculty_leave_view_form" model="ir.ui.view">
        <field name="name">faculty.leave.view.form</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <form string="Faculty Leave">
                <header>
                    <button name="action_submit" type="object" string="Submit"
                            class="oe_highlight"
                            invisible="state != 'draft'"/>
                    <button name="action_hod_approve" type="object" string="HOD Approve"
                            class="oe_highlight"
                            invisible="state != 'submitted'"/>
                    <button name="action_approve" type="object" string="Principal Approve"
                            class="oe_highlight"
                            invisible="state != 'hod_approved'"/>
                    <button name="action_reject" type="object" string="Reject"
                            invisible="state not in ['submitted', 'hod_approved']"/>
                    <button name="action_cancel" type="object" string="Cancel"
                            invisible="state not in ['draft', 'submitted']"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,submitted,hod_approved,approved"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" string="Leave Number"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Faculty Information">
                            <field name="faculty_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="employee_id" readonly="1" invisible="1"/>
                            <field name="department_id" readonly="1"/>
                        </group>
                        <group string="Leave Details">
                            <field name="leave_type" widget="radio"/>
                        </group>
                    </group>

                    <group>
                        <group string="Duration">
                            <field name="date_from" widget="date"/>
                            <field name="date_to" widget="date"/>
                            <field name="half_day" widget="boolean_toggle"/>
                            <field name="half_day_type"
                                   invisible="not half_day"/>
                            <field name="number_of_days" readonly="1"/>
                        </group>
                        <group string="Reason">
                            <field name="reason"
                                   placeholder="Enter reason for leave..."
                                   nolabel="1"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Supporting Documents" name="documents">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>

                        <page string="Substitute Arrangement" name="substitute">
                            <group>
                                <group>
                                    <field name="substitute_required" widget="boolean_toggle"/>
                                    <field name="substitute_faculty_id"
                                           invisible="not substitute_required"
                                           options="{'no_create': True, 'no_create_edit': True}"/>
                                </group>
                            </group>
                            <separator string="Substitute Arrangement Details"
                                       invisible="not substitute_required"/>
                            <field name="substitute_arrangement"
                                   placeholder="Enter substitute arrangement details (classes to be covered, timetable adjustments, etc.)..."
                                   invisible="not substitute_required"
                                   nolabel="1"/>
                        </page>

                        <page string="Approval Details" name="approval">
                            <group>
                                <group string="HOD Approval">
                                    <field name="approved_by_hod" readonly="1"/>
                                    <field name="hod_approval_date" readonly="1"/>
                                </group>
                                <group string="Principal Approval">
                                    <field name="approved_by_principal" readonly="1"/>
                                    <field name="principal_approval_date" readonly="1"/>
                                </group>
                            </group>

                            <separator string="Rejection Reason"
                                       invisible="state != 'rejected'"/>
                            <field name="rejection_reason"
                                   placeholder="Enter reason for rejection..."
                                   invisible="state != 'rejected'"
                                   nolabel="1"/>
                        </page>

                        <page string="Notes" name="notes">
                            <field name="notes"
                                   placeholder="Enter any additional notes..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- List View -->
    <record id="faculty_leave_view_list" model="ir.ui.view">
        <field name="name">faculty.leave.view.list</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <list string="Faculty Leaves"
                  default_order="date_from desc"
                  multi_edit="1"
                  sample="1"
                  decoration-success="state == 'approved'"
                  decoration-info="state == 'hod_approved'"
                  decoration-warning="state == 'submitted'"
                  decoration-danger="state == 'rejected'"
                  decoration-muted="state in ['draft', 'cancelled']">
                <field name="name"/>
                <field name="faculty_id"/>
                <field name="department_id" optional="show"/>
                <field name="leave_type"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="number_of_days" sum="Total Days" optional="show"/>
                <field name="half_day" widget="boolean_toggle" optional="hide"/>
                <field name="substitute_required" widget="boolean_toggle" optional="hide"/>
                <field name="substitute_faculty_id" optional="hide"/>
                <field name="approved_by_hod" optional="hide"/>
                <field name="approved_by_principal" optional="hide"/>
                <field name="state" widget="badge"
                       decoration-success="state == 'approved'"
                       decoration-info="state == 'hod_approved'"
                       decoration-warning="state == 'submitted'"
                       decoration-danger="state == 'rejected'"
                       decoration-muted="state in ['draft', 'cancelled']"/>
            </list>
        </field>
    </record>

    <!-- Search View -->
    <record id="faculty_leave_view_search" model="ir.ui.view">
        <field name="name">faculty.leave.view.search</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <search string="Search Faculty Leaves">
                <field name="name"/>
                <field name="faculty_id"/>
                <field name="department_id"/>
                <field name="leave_type"/>

                <separator/>

                <filter name="filter_draft" string="Draft"
                        domain="[('state', '=', 'draft')]"/>
                <filter name="filter_submitted" string="Submitted"
                        domain="[('state', '=', 'submitted')]"/>
                <filter name="filter_hod_approved" string="HOD Approved"
                        domain="[('state', '=', 'hod_approved')]"/>
                <filter name="filter_approved" string="Approved"
                        domain="[('state', '=', 'approved')]"/>
                <filter name="filter_rejected" string="Rejected"
                        domain="[('state', '=', 'rejected')]"/>
                <filter name="filter_cancelled" string="Cancelled"
                        domain="[('state', '=', 'cancelled')]"/>

                <separator/>

                <filter name="filter_casual" string="Casual Leave"
                        domain="[('leave_type', '=', 'casual')]"/>
                <filter name="filter_sick" string="Sick Leave"
                        domain="[('leave_type', '=', 'sick')]"/>
                <filter name="filter_earned" string="Earned Leave"
                        domain="[('leave_type', '=', 'earned')]"/>
                <filter name="filter_maternity" string="Maternity Leave"
                        domain="[('leave_type', '=', 'maternity')]"/>
                <filter name="filter_paternity" string="Paternity Leave"
                        domain="[('leave_type', '=', 'paternity')]"/>
                <filter name="filter_compensatory" string="Compensatory Off"
                        domain="[('leave_type', '=', 'compensatory')]"/>
                <filter name="filter_unpaid" string="Leave Without Pay"
                        domain="[('leave_type', '=', 'unpaid')]"/>
                <filter name="filter_sabbatical" string="Sabbatical Leave"
                        domain="[('leave_type', '=', 'sabbatical')]"/>
                <filter name="filter_study" string="Study Leave"
                        domain="[('leave_type', '=', 'study')]"/>
                <filter name="filter_emergency" string="Emergency Leave"
                        domain="[('leave_type', '=', 'emergency')]"/>

                <separator/>

                <filter name="filter_half_day" string="Half Day"
                        domain="[('half_day', '=', True)]"/>
                <filter name="filter_substitute_required" string="Substitute Required"
                        domain="[('substitute_required', '=', True)]"/>

                <separator/>

                <filter name="filter_today" string="Today"
                        domain="[('date_from', '&lt;=', context_today().strftime('%Y-%m-%d')),
                                 ('date_to', '&gt;=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_week" string="This Week"
                        domain="[('date_from', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')),
                                 ('date_from', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_month" string="This Month"
                        domain="[('date_from', '&gt;=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                                 ('date_from', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_faculty" string="Faculty"
                            context="{'group_by': 'faculty_id'}"/>
                    <filter name="group_by_department" string="Department"
                            context="{'group_by': 'department_id'}"/>
                    <filter name="group_by_leave_type" string="Leave Type"
                            context="{'group_by': 'leave_type'}"/>
                    <filter name="group_by_state" string="Status"
                            context="{'group_by': 'state'}"/>
                    <filter name="group_by_from_date" string="From Date"
                            context="{'group_by': 'date_from'}"/>
                    <filter name="group_by_month" string="Month"
                            context="{'group_by': 'date_from:month'}"/>
                </group>

                <searchpanel>
                    <field name="department_id" string="Department"
                           select="multi"
                           icon="fa-building"/>
                    <field name="leave_type" string="Leave Type"
                           select="multi"
                           icon="fa-plane"/>
                    <field name="state" string="Status"
                           select="multi"
                           icon="fa-filter"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="faculty_leave_view_kanban" model="ir.ui.view">
        <field name="name">faculty.leave.view.kanban</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="state"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="faculty_id"/>
                <field name="department_id"/>
                <field name="leave_type"/>
                <field name="date_from"/>
                <field name="date_to"/>
                <field name="number_of_days"/>
                <field name="half_day"/>
                <field name="substitute_required"/>
                <field name="substitute_faculty_id"/>
                <field name="state"/>

                <progressbar field="state"
                             colors='{"draft": "muted", "submitted": "warning", "hod_approved": "info", "approved": "success", "rejected": "danger", "cancelled": "muted"}'/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="faculty_id"/>
                                        </strong>
                                        <div class="text-muted">
                                            <field name="name"/>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <field name="state" widget="badge"
                                               decoration-success="state == 'approved'"
                                               decoration-info="state == 'hod_approved'"
                                               decoration-warning="state == 'submitted'"
                                               decoration-danger="state == 'rejected'"
                                               decoration-muted="state in ['draft', 'cancelled']"/>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body">
                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <i class="fa fa-building text-primary"/>
                                            <field name="department_id"/>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <span class="badge text-bg-primary">
                                                <i class="fa fa-plane"/> <field name="leave_type"/>
                                            </span>
                                            <span t-if="record.half_day.raw_value"
                                                  class="badge text-bg-info ms-1">
                                                <i class="fa fa-clock-o"/> Half Day
                                            </span>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <i class="fa fa-calendar text-secondary"/>
                                            <field name="date_from"/> to <field name="date_to"/>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <i class="fa fa-clock-o text-warning"/>
                                            <strong><field name="number_of_days"/> days</strong>
                                        </div>
                                        <div class="col-6" t-if="record.substitute_required.raw_value">
                                            <i class="fa fa-user text-info"/>
                                            <small>Substitute: <field name="substitute_faculty_id"/></small>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_right">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendar View -->
    <record id="faculty_leave_view_calendar" model="ir.ui.view">
        <field name="name">faculty.leave.view.calendar</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <calendar string="Leave Calendar"
                      date_start="date_from"
                      date_stop="date_to"
                      color="faculty_id"
                      mode="month"
                      event_open_popup="true"
                      quick_create="false">
                <field name="faculty_id"/>
                <field name="leave_type"/>
                <field name="state"/>
                <field name="number_of_days"/>
            </calendar>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="faculty_leave_view_pivot" model="ir.ui.view">
        <field name="name">faculty.leave.view.pivot</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <pivot string="Leave Analysis">
                <field name="faculty_id" type="row"/>
                <field name="leave_type" type="col"/>
                <field name="number_of_days" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="faculty_leave_view_graph" model="ir.ui.view">
        <field name="name">faculty.leave.view.graph</field>
        <field name="model">faculty.leave</field>
        <field name="arch" type="xml">
            <graph string="Leave Statistics" type="bar">
                <field name="leave_type"/>
                <field name="number_of_days" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_faculty_leave" model="ir.actions.act_window">
        <field name="name">Faculty Leaves</field>
        <field name="res_model">faculty.leave</field>
        <field name="view_mode">list,kanban,form,calendar,pivot,graph</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Faculty Leave Application
            </p>
            <p>
                Manage faculty leave requests with two-tier approval workflow (HOD and Principal).
                Supports 10 leave types including casual, sick, earned, maternity, paternity,
                compensatory, unpaid, sabbatical, study, and emergency leaves. Track substitute
                arrangements and automatically create attendance records.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_faculty_leave"-->
<!--              name="Leaves"-->
<!--              parent="menu_faculty_root"-->
<!--              action="action_faculty_leave"-->
<!--              sequence="25"/>-->

</odoo>
