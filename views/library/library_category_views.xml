<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View - Library Category -->
    <record id="library_category_view_form" model="ir.ui.view">
        <field name="name">library.category.view.form</field>
        <field name="model">library.category</field>
        <field name="arch" type="xml">
            <form string="Book Category">
                <sheet>
                    <div class="oe_title">
                        <label for="name" string="Category Name"/>
                        <h1>
                            <field name="name" placeholder="e.g., Computer Science, Fiction, History"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="code" placeholder="e.g., CS, FIC, HIST"/>
                            <field name="parent_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="parent_path" invisible="1"/>
                        </group>
                        <group>
                            <field name="total_books" readonly="1"/>
                            <field name="active" widget="boolean_toggle"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Description" name="description">
                            <field name="description" nolabel="1"
                                   placeholder="Enter category description..."/>
                        </page>

                        <page string="Subcategories" name="subcategories">
                            <field name="child_ids" nolabel="1">
                                <list string="Subcategories" editable="bottom">
                                    <field name="name"/>
                                    <field name="code"/>
                                    <field name="total_books" readonly="1"/>
                                    <field name="active" widget="boolean_toggle"/>
                                </list>
                            </field>
                        </page>

                        <page string="Books" name="books">
                            <field name="book_ids" nolabel="1">
                                <list string="Books">
                                    <field name="title"/>
                                    <field name="isbn"/>
                                    <field name="primary_author"/>
                                    <field name="publication_year"/>
                                    <field name="total_copies"/>
                                    <field name="available_copies"
                                           decoration-success="available_copies &gt; 0"
                                           decoration-danger="available_copies == 0"/>
                                    <field name="state" widget="badge"
                                           decoration-success="state == 'available'"
                                           decoration-danger="state in ['lost', 'damaged']"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- List View - Library Category -->
    <record id="library_category_view_list" model="ir.ui.view">
        <field name="name">library.category.view.list</field>
        <field name="model">library.category</field>
        <field name="arch" type="xml">
            <list string="Book Categories"
                  default_order="name"
                  editable="bottom"
                  sample="1"
                  decoration-muted="not active">
                <field name="name"/>
                <field name="code"/>
                <field name="parent_id" optional="show"/>
                <field name="total_books" readonly="1"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- Search View - Library Category -->
    <record id="library_category_view_search" model="ir.ui.view">
        <field name="name">library.category.view.search</field>
        <field name="model">library.category</field>
        <field name="arch" type="xml">
            <search string="Search Categories">
                <field name="name"/>
                <field name="code"/>
                <field name="parent_id"/>

                <separator/>

                <filter name="filter_active" string="Active"
                        domain="[('active', '=', True)]"/>
                <filter name="filter_archived" string="Archived"
                        domain="[('active', '=', False)]"/>

                <separator/>

                <filter name="filter_parent_categories" string="Parent Categories"
                        domain="[('parent_id', '=', False)]"/>
                <filter name="filter_subcategories" string="Subcategories"
                        domain="[('parent_id', '!=', False)]"/>

                <separator/>

                <filter name="filter_with_books" string="With Books"
                        domain="[('total_books', '&gt;', 0)]"/>
                <filter name="filter_no_books" string="No Books"
                        domain="[('total_books', '=', 0)]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_parent" string="Parent Category"
                            context="{'group_by': 'parent_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View - Library Category -->
    <record id="library_category_view_kanban" model="ir.ui.view">
        <field name="name">library.category.view.kanban</field>
        <field name="model">library.category</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" quick_create="false" sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="code"/>
                <field name="parent_id"/>
                <field name="total_books"/>
                <field name="active"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="ribbon ribbon-top-right" t-if="!record.active.raw_value">
                                <span class="text-bg-secondary">Archived</span>
                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="text-muted" t-if="record.code.raw_value">
                                            Code: <field name="code"/>
                                        </div>
                                        <div class="text-muted" t-if="record.parent_id.raw_value">
                                            <i class="fa fa-folder-open text-info"/>
                                            Parent: <field name="parent_id"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body mt-3">
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <div class="card bg-primary text-white">
                                                <div class="card-body p-3">
                                                    <h2 class="mb-0"><field name="total_books"/></h2>
                                                    <small>Total Books</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action -->
    <record id="action_library_category" model="ir.actions.act_window">
        <field name="name">Book Categories</field>
        <field name="res_model">library.category</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Book Category
            </p>
            <p>
                Manage library book categories with hierarchical structure. System supports _parent_store
                for efficient parent/child relationships. Enter category name (required) like "Computer
                Science", "Fiction", "History". Add optional category code like "CS", "FIC", "HIST" for
                quick reference. Select parent category to create hierarchical structure (e.g., "Programming"
                under "Computer Science", "Java" under "Programming"). System automatically maintains
                parent_path (indexed) for efficient hierarchy queries. View subcategories in dedicated page.
                View all books in category via one2many relation to library.book. System automatically
                computes total books count. Add text description for category. Active flag for archiving.
                Supports unlimited levels of hierarchy.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_library_category"-->
<!--              name="Categories"-->
<!--              parent="menu_library_root"-->
<!--              action="action_library_category"-->
<!--              sequence="40"/>-->

</odoo>
