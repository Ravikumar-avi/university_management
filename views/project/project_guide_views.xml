<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View - Project Guide -->
    <record id="project_guide_view_form" model="ir.ui.view">
        <field name="name">project.guide.view.form</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <form string="Project Guide">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object" name="action_view_projects" icon="fa-folder">
                            <field name="total_projects" widget="statinfo" string="Total Projects"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_guide_projects" icon="fa-bookmark">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="project_ids" widget="statinfo" string="0"/>
                                </span>
                                <span class="o_stat_text">As Guide</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_view_co_guide_projects" icon="fa-bookmark-o">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="co_guide_project_ids" widget="statinfo" string="0"/>
                                </span>
                                <span class="o_stat_text">As Co-Guide</span>
                            </div>
                        </button>
                    </div>

                    <widget name="web_ribbon" title="Available" bg_color="bg-success" invisible="not available"/>
                    <widget name="web_ribbon" title="Not Available" bg_color="bg-danger" invisible="available"/>

                    <group>
                        <group string="Faculty Details">
                            <field name="faculty_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="academic_year_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                        </group>
                        <group string="Project Capacity">
                            <field name="max_projects_allowed"/>
                            <field name="available" widget="boolean_toggle"/>
                            <div class="alert alert-warning" role="alert"
                                 invisible="total_projects &lt; max_projects_allowed">
                                <i class="fa fa-exclamation-triangle"/>
                                <strong>Warning:</strong> Project limit reached or exceeded!
                            </div>
                        </group>
                    </group>

                    <notebook>
                        <page string="Projects as Guide" name="guide_projects">
                            <field name="project_ids" nolabel="1">
                                <list string="Projects as Guide" create="0" delete="0">
                                    <field name="name"/>
                                    <field name="student_ids"/>
                                    <field name="department_id"/>
                                    <field name="start_date"/>
                                    <field name="state" widget="badge"
                                           decoration-info="state == 'proposed'"
                                           decoration-warning="state == 'in_progress'"
                                           decoration-success="state == 'completed'"
                                           decoration-muted="state == 'cancelled'"/>
                                </list>
                            </field>
                        </page>

                        <page string="Projects as Co-Guide" name="co_guide_projects">
                            <field name="co_guide_project_ids" nolabel="1">
                                <list string="Projects as Co-Guide" create="0" delete="0">
                                    <field name="name"/>
                                    <field name="student_ids"/>
                                    <field name="department_id"/>
                                    <field name="start_date"/>
                                    <field name="state" widget="badge"
                                           decoration-info="state == 'proposed'"
                                           decoration-warning="state == 'in_progress'"
                                           decoration-success="state == 'completed'"
                                           decoration-muted="state == 'cancelled'"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- List View - Project Guide -->
    <record id="project_guide_view_list" model="ir.ui.view">
        <field name="name">project.guide.view.list</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <list string="Project Guides"
                  default_order="academic_year_id desc"
                  multi_edit="1"
                  sample="1"
                  decoration-success="available == True"
                  decoration-muted="available == False">
                <field name="faculty_id"/>
                <field name="academic_year_id"/>
                <field name="total_projects" optional="show"/>
                <field name="max_projects_allowed" optional="show"/>
                <field name="available" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- Search View - Project Guide -->
    <record id="project_guide_view_search" model="ir.ui.view">
        <field name="name">project.guide.view.search</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <search string="Search Project Guides">
                <field name="faculty_id"/>
                <field name="academic_year_id"/>

                <separator/>

                <filter name="filter_available" string="Available"
                        domain="[('available', '=', True)]"/>
                <filter name="filter_not_available" string="Not Available"
                        domain="[('available', '=', False)]"/>

                <separator/>

                <filter name="filter_under_capacity" string="Under Capacity"
                        domain="[('total_projects', '&lt;', '5')]"/>
                <filter name="filter_at_capacity" string="At Capacity"
                        domain="[('total_projects', '&gt;=', '5')]"/>

                <separator/>

                <filter name="filter_current_year" string="Current Academic Year"
                        domain="[('academic_year_id.is_current', '=', True)]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_faculty" string="Faculty"
                            context="{'group_by': 'faculty_id'}"/>
                    <filter name="group_by_academic_year" string="Academic Year"
                            context="{'group_by': 'academic_year_id'}"/>
                    <filter name="group_by_available" string="Availability"
                            context="{'group_by': 'available'}"/>
                </group>

                <searchpanel>
                    <field name="academic_year_id" string="Academic Year"
                           icon="fa-calendar"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View - Project Guide -->
    <record id="project_guide_view_kanban" model="ir.ui.view">
        <field name="name">project.guide.view.kanban</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="academic_year_id"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="faculty_id"/>
                <field name="academic_year_id"/>
                <field name="total_projects"/>
                <field name="max_projects_allowed"/>
                <field name="available"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="ribbon ribbon-top-right" t-if="record.available.raw_value">
                                    <span class="bg-success">Available</span>
                                </div>
                                <div class="ribbon ribbon-top-right" t-if="!record.available.raw_value">
                                    <span class="bg-danger">Not Available</span>
                                </div>

                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <i class="fa fa-user"/> <field name="faculty_id"/>
                                        </strong>
                                        <div class="text-muted">
                                            <small>
                                                <i class="fa fa-calendar"/> <field name="academic_year_id"/>
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body mt-3">
                                    <div class="row mb-2">
                                        <div class="col-6">
                                            <div class="bg-light p-2 rounded text-center">
                                                <div class="text-primary">
                                                    <i class="fa fa-folder fa-lg"/>
                                                </div>
                                                <h4 class="mb-0"><field name="total_projects"/></h4>
                                                <small class="text-muted">Total Projects</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="bg-light p-2 rounded text-center">
                                                <div class="text-success">
                                                    <i class="fa fa-check-circle fa-lg"/>
                                                </div>
                                                <h4 class="mb-0"><field name="max_projects_allowed"/></h4>
                                                <small class="text-muted">Max Allowed</small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <div class="progress" style="height: 25px;">
                                                <div class="progress-bar"
                                                     role="progressbar"
                                                     t-attf-style="width: {{(record.total_projects.raw_value / record.max_projects_allowed.raw_value * 100).toFixed(0)}}%"
                                                     t-attf-class="{{
                                                        (record.total_projects.raw_value / record.max_projects_allowed.raw_value) &lt; 0.5 ? 'bg-success' :
                                                        ((record.total_projects.raw_value / record.max_projects_allowed.raw_value) &lt; 0.8 ? 'bg-warning' : 'bg-danger')
                                                     }}">
                                                    <strong>
                                                        <t t-esc="(record.total_projects.raw_value / record.max_projects_allowed.raw_value * 100).toFixed(0)"/>%
                                                    </strong>
                                                </div>
                                            </div>
                                            <small class="text-muted text-center d-block mt-1">Capacity Utilization</small>
                                        </div>
                                    </div>

                                    <div class="row mb-2" t-if="record.total_projects.raw_value &gt;= record.max_projects_allowed.raw_value">
                                        <div class="col-12">
                                            <div class="alert alert-danger mb-0 p-2 text-center">
                                                <small>
                                                    <i class="fa fa-exclamation-triangle"/> Capacity Limit Reached!
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Pivot View - Project Guide -->
    <record id="project_guide_view_pivot" model="ir.ui.view">
        <field name="name">project.guide.view.pivot</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <pivot string="Guide Analysis">
                <field name="faculty_id" type="row"/>
                <field name="academic_year_id" type="col"/>
                <field name="total_projects" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View - Project Guide -->
    <record id="project_guide_view_graph" model="ir.ui.view">
        <field name="name">project.guide.view.graph</field>
        <field name="model">project.guide</field>
        <field name="arch" type="xml">
            <graph string="Guide Statistics" type="bar">
                <field name="faculty_id"/>
                <field name="total_projects" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_project_guide" model="ir.actions.act_window">
        <field name="name">Project Guides</field>
        <field name="res_model">project.guide</field>
        <field name="view_mode">kanban,list,form,pivot,graph</field>
        <field name="context">{'search_default_filter_current_year': 1, 'search_default_filter_available': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Assign Project Guide
            </p>
            <p>
                Manage faculty assignments as project guides with capacity tracking. Select faculty_id
                (Many2one to faculty.faculty, required, indexed, no-create). Select academic_year_id
                (Many2one to university.academic.year, required, no-create). View project_ids (One2many
                from student.project guide_id inverse, Projects as Guide, shown in read-only embedded list
                with 5 fields: name/student_ids/department_id/start_date/state with 4-color badge
                decorations info-proposed/warning-in_progress/success-completed/muted-cancelled, no
                create/delete). View co_guide_project_ids (One2many from student.project co_guide_id
                inverse, Projects as Co-Guide, same 5-field read-only list). View total_projects (integer,
                computed count of project_ids + co_guide_project_ids via _compute_total with api.depends,
                displayed in stat button "Total Projects" with folder icon, also shown in individual stat
                buttons: "As Guide" bookmark icon showing project_ids count, "As Co-Guide" bookmark-o icon
                showing co_guide_project_ids count). Enter max_projects_allowed (integer, default 5,
                editable). Toggle available (boolean, default true, boolean_toggle widget, "Available for
                New Projects"). Form view has web_ribbon widgets: success/green "Available" if available,
                danger/red "Not Available" if not available. Warning alert box (warning/yellow,
                exclamation-triangle icon, "Warning: Project limit reached or exceeded!", conditional
                visible if total_projects ≥ max_projects_allowed). List view with 2-color row decorations:
                Success/Green (available=true), Muted (available=false). Kanban view grouped by
                academic_year_id showing faculty name (user icon), academic year (calendar icon, small),
                2-card grid (6/6): total_projects card (light background, centered, folder icon
                primary/blue, h4) &amp; max_projects_allowed card (light background, centered, check-circle
                icon success/green, h4), capacity utilization progress bar (dynamic 3-color based on
                percentage: success/green &lt;50%, warning/yellow 50-79%, danger/red ≥80%, height 25px,
                shows percentage text, "Capacity Utilization" label), danger alert if at/over capacity
                (exclamation-triangle icon, "Capacity Limit Reached!"), ribbon badges (success "Available"
                or danger "Not Available" at top-right). Filters for availability (available/not
                available) &amp; capacity (under/at capacity using total_projects&lt;5/≥5). Pivot view for
                analysis (faculty × academic_year matrix, measure: total_projects). Graph view for
                statistics (bar chart, faculty vs. total_projects). Ordered by academic_year_id desc (most
                recent first). Default filters: Current academic year &amp; Available guides. Capacity
                tracking &amp; workload management for faculty project supervision.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_project_guide"-->
<!--              name="Guides"-->
<!--              parent="menu_project_root"-->
<!--              action="action_project_guide"-->
<!--              sequence="10"/>-->

</odoo>
