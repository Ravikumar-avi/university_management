<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View - Timetable Substitution -->
    <record id="timetable_substitution_view_form" model="ir.ui.view">
        <field name="name">timetable.substitution.view.form</field>
        <field name="model">timetable.substitution</field>
        <field name="arch" type="xml">
            <form string="Substitute Teacher Assignment">
                <header>
                    <button name="action_approve" string="Approve" type="object"
                            class="btn-primary"
                            invisible="state != 'draft'"
                            confirm="Approve this substitution?"/>
                    <button name="action_complete" string="Mark as Completed" type="object"
                            class="btn-success"
                            invisible="state != 'approved'"
                            confirm="Mark this substitution as completed?"/>
                    <button name="action_cancel" string="Cancel" type="object"
                            class="btn-danger"
                            invisible="state in ['completed', 'cancelled']"
                            confirm="Cancel this substitution?"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,approved,completed"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" string="Substitution Number"/>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Original Class Details">
                            <field name="timetable_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="subject_id" readonly="1"/>
                            <field name="original_faculty_id" readonly="1"/>
                        </group>
                        <group string="Substitution Details">
                            <field name="date"/>
                            <field name="substitute_faculty_id"
                                   options="{'no_create': True, 'no_create_edit': True}"/>
                        </group>
                    </group>

                    <group>
                        <group string="Reason for Substitution">
                            <field name="reason"/>
                            <field name="reason_details"
                                   placeholder="Provide additional details about the reason..."/>
                        </group>
                        <group string="Additional Information">
                            <field name="remarks"
                                   placeholder="Add any remarks or special instructions..."/>
                        </group>
                    </group>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- List View - Timetable Substitution -->
    <record id="timetable_substitution_view_list" model="ir.ui.view">
        <field name="name">timetable.substitution.view.list</field>
        <field name="model">timetable.substitution</field>
        <field name="arch" type="xml">
            <list string="Substitute Teacher Assignments"
                  default_order="date desc"
                  multi_edit="1"
                  sample="1"
                  decoration-info="state == 'draft'"
                  decoration-primary="state == 'approved'"
                  decoration-success="state == 'completed'"
                  decoration-muted="state == 'cancelled'">
                <field name="name"/>
                <field name="date"/>
                <field name="subject_id"/>
                <field name="original_faculty_id"/>
                <field name="substitute_faculty_id"/>
                <field name="reason" optional="show"/>
                <field name="state" widget="badge"
                       decoration-info="state == 'draft'"
                       decoration-primary="state == 'approved'"
                       decoration-success="state == 'completed'"
                       decoration-muted="state == 'cancelled'"/>
            </list>
        </field>
    </record>

    <!-- Search View - Timetable Substitution -->
    <record id="timetable_substitution_view_search" model="ir.ui.view">
        <field name="name">timetable.substitution.view.search</field>
        <field name="model">timetable.substitution</field>
        <field name="arch" type="xml">
            <search string="Search Substitutions">
                <field name="name"/>
                <field name="subject_id"/>
                <field name="original_faculty_id"/>
                <field name="substitute_faculty_id"/>
                <field name="date"/>

                <separator/>

                <filter name="filter_draft" string="Draft"
                        domain="[('state', '=', 'draft')]"/>
                <filter name="filter_approved" string="Approved"
                        domain="[('state', '=', 'approved')]"/>
                <filter name="filter_completed" string="Completed"
                        domain="[('state', '=', 'completed')]"/>
                <filter name="filter_cancelled" string="Cancelled"
                        domain="[('state', '=', 'cancelled')]"/>

                <separator/>

                <filter name="filter_today" string="Today"
                        domain="[('date', '=', context_today())]"/>
                <filter name="filter_this_week" string="This Week"
                        domain="[('date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')),
                                 ('date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_this_month" string="This Month"
                        domain="[('date', '&gt;=', (context_today().replace(day=1)).strftime('%Y-%m-%d')),
                                 ('date', '&lt;=', ((context_today().replace(day=1) + datetime.timedelta(days=32)).replace(day=1) - datetime.timedelta(days=1)).strftime('%Y-%m-%d'))]"/>
                <filter name="filter_future" string="Upcoming"
                        domain="[('date', '&gt;=', context_today())]"/>
                <filter name="filter_past" string="Past"
                        domain="[('date', '&lt;', context_today())]"/>

                <separator/>

                <filter name="filter_leave" string="Leave"
                        domain="[('reason', '=', 'leave')]"/>
                <filter name="filter_meeting" string="Official Meeting"
                        domain="[('reason', '=', 'meeting')]"/>
                <filter name="filter_conference" string="Conference/Seminar"
                        domain="[('reason', '=', 'conference')]"/>
                <filter name="filter_emergency" string="Emergency"
                        domain="[('reason', '=', 'emergency')]"/>

                <group expand="0" string="Group By">
                    <filter name="group_by_date" string="Date"
                            context="{'group_by': 'date'}"/>
                    <filter name="group_by_subject" string="Subject"
                            context="{'group_by': 'subject_id'}"/>
                    <filter name="group_by_original_faculty" string="Original Faculty"
                            context="{'group_by': 'original_faculty_id'}"/>
                    <filter name="group_by_substitute_faculty" string="Substitute Faculty"
                            context="{'group_by': 'substitute_faculty_id'}"/>
                    <filter name="group_by_reason" string="Reason"
                            context="{'group_by': 'reason'}"/>
                    <filter name="group_by_state" string="Status"
                            context="{'group_by': 'state'}"/>
                </group>

                <searchpanel>
                    <field name="state" string="Status"
                           select="multi"
                           icon="fa-flag"/>
                    <field name="reason" string="Reason"
                           select="multi"
                           icon="fa-question-circle"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <!-- Kanban View - Timetable Substitution -->
    <record id="timetable_substitution_view_kanban" model="ir.ui.view">
        <field name="name">timetable.substitution.view.kanban</field>
        <field name="model">timetable.substitution</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile"
                    default_group_by="state"
                    quick_create="false"
                    sample="1">
                <field name="id"/>
                <field name="name"/>
                <field name="date"/>
                <field name="subject_id"/>
                <field name="original_faculty_id"/>
                <field name="substitute_faculty_id"/>
                <field name="reason"/>
                <field name="state"/>
                <field name="activity_ids"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="text-muted mt-1">
                                            <small>
                                                <i class="fa fa-calendar"/>
                                                <field name="date"/>
                                            </small>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_headings text-end">
                                        <span t-attf-class="badge {{
                                            record.reason.raw_value == 'leave' ? 'bg-warning' :
                                            (record.reason.raw_value == 'meeting' ? 'bg-info' :
                                            (record.reason.raw_value == 'conference' ? 'bg-primary' :
                                            (record.reason.raw_value == 'emergency' ? 'bg-danger' : 'bg-secondary')))
                                        }}">
                                            <field name="reason"/>
                                        </span>
                                    </div>
                                </div>

                                <div class="o_kanban_record_body mt-3">
                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <div class="alert alert-primary mb-0 p-2">
                                                <small class="text-muted d-block">Subject</small>
                                                <strong>
                                                    <i class="fa fa-book"/>
                                                    <field name="subject_id"/>
                                                </strong>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <small class="text-muted d-block">Original Faculty</small>
                                                <small>
                                                    <i class="fa fa-user text-danger"/>
                                                    <field name="original_faculty_id"/>
                                                </small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-12">
                                            <div class="bg-light p-2 rounded">
                                                <small class="text-muted d-block">Substitute Faculty</small>
                                                <small>
                                                    <i class="fa fa-user-plus text-success"/>
                                                    <field name="substitute_faculty_id"/>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom mt-2">
                                    <div class="oe_kanban_bottom_right">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Calendar View - Timetable Substitution -->
    <record id="timetable_substitution_view_calendar" model="ir.ui.view">
        <field name="name">timetable.substitution.view.calendar</field>
        <field name="model">timetable.substitution</field>
        <field name="arch" type="xml">
            <calendar string="Substitution Calendar"
                      date_start="date"
                      mode="month"
                      quick_create="0"
                      color="state"
                      event_open_popup="1">
                <field name="subject_id"/>
                <field name="original_faculty_id"/>
                <field name="substitute_faculty_id"/>
                <field name="reason"/>
            </calendar>
        </field>
    </record>

    <!-- Action -->
    <record id="action_timetable_substitution" model="ir.actions.act_window">
        <field name="name">Timetable Substitution</field>
        <field name="res_model">timetable.substitution</field>
        <field name="view_mode">list,kanban,form,calendar</field>
        <field name="context">{'search_default_filter_future': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Substitute Teacher Assignment
            </p>
            <p>
                Manage substitute teacher assignments with comprehensive features. View name (char required
                readonly copy=False default '/', auto-generated via ir.sequence 'timetable.substitution',
                'Substitution Number', displayed as h1 title labeled "Substitution Number"). Select timetable_id
                (Many2one to class.timetable required tracked, 'Original Class', no-create). View subject_id
                (Many2one related from timetable_id.subject_id stored readonly, 'Subject'). View
                original_faculty_id (Many2one related from timetable_id.faculty_id stored readonly, 'Original
                Faculty'). Select date (date required default fields.Date.today tracked, 'Substitution Date').
                Select substitute_faculty_id (Many2one to faculty.faculty required tracked, 'Substitute Faculty',
                no-create). Select reason (5 options required, 'Reason'): leave (Faculty on Leave), meeting
                (Official Meeting), conference (Conference/Seminar), emergency (Emergency), other (Other). Enter
                reason_details (text, 'Reason Details', placeholder "Provide additional details about the
                reason..."). Enter remarks (text, 'Remarks', placeholder "Add any remarks or special
                instructions..."). View state (4 options default draft tracked, 'Status', statusbar visible
                draft-approved-completed): draft (Draft), approved (Approved), completed (Completed), cancelled
                (Cancelled). Form view with header statusbar and 3 action buttons: action_approve (primary button
                "Approve", shown only in draft state, confirmation dialog "Approve this substitution?"),
                action_complete (success button "Mark as Completed", shown only in approved state, confirmation
                "Mark this substitution as completed?"), action_cancel (danger button "Cancel", shown in all
                states except completed/cancelled, confirmation "Cancel this substitution?"). Form layout with 2
                groups: Original Class Details (timetable_id no-create/subject_id readonly/original_faculty_id
                readonly) and Substitution Details (date/substitute_faculty_id no-create), plus 2 more groups:
                Reason for Substitution (reason/reason_details with placeholder) and Additional Information
                (remarks with placeholder). List view with multi_edit, ordered by date desc, 4-color row
                decorations (info for draft, primary for approved, success for completed, muted for cancelled),
                badge widget for state with 4 decorations, optional reason field. Kanban view grouped by state
                showing name as title with date (calendar icon), reason badge at top-right (5-color: warning
                yellow for leave, info light-blue for meeting, primary blue for conference, danger red for
                emergency, secondary gray for other), subject_id alert (primary background, book icon, "Subject"
                label), original_faculty_id card (light background, user icon danger, "Original Faculty" label),
                substitute_faculty_id card (light background, user-plus icon success, "Substitute Faculty" label),
                activity widget at bottom-right. Calendar view with date_start using date field, mode month, color
                by state, event_open_popup. Ordered by date desc. Default filter: Upcoming substitutions
                (filter_future). Comprehensive search filters for 4 states/date ranges (today/this week/this
                month/upcoming/past)/4 reason types/group by date-subject-original_faculty-substitute_faculty-
                reason-state. Searchpanel for state and reason multi-select. SQL constraint for unique name. Full
                chatter/activity support. Complete substitute teacher management with workflow (draft -> approved
                -> completed or cancelled) and automatic sequence generation.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
<!--    <menuitem id="menu_timetable_substitution"-->
<!--              name="Timetable Substitution"-->
<!--              parent="menu_timetable_root"-->
<!--              action="action_timetable_substitution"-->
<!--              sequence="40"/>-->

</odoo>
